

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Interfacing Fortran and Python &mdash; Python Topics 2.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=3ee1c6c6" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=73cda6fb"></script>
      <script src="../_static/doctools.js?v=888ff710"></script>
      <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Interfacing C and Python" href="c_python.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Python Topics
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../weak_references.html">Python Memory Management and Weak References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../persistance_serialization.html">Persistence and Serialization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../where_to_put_tests.html">Where to Put Tests?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../where_to_put_your_code.html">Where to put your custom code?</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Interfacing with Compiled Code</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html#topics">Topics:</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="c_python.html">Interfacing C and Python</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Interfacing Fortran and Python</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#documentation">Documentation:</a></li>
<li class="toctree-l4"><a class="reference internal" href="#interfacing-methods">Interfacing methods:</a></li>
<li class="toctree-l4"><a class="reference internal" href="#an-example">An Example:</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Python Topics</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Interfacing with Compiled Code</a></li>
      <li class="breadcrumb-item active">Interfacing Fortran and Python</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/interfacing_with_c/fortran_python.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="interfacing-fortran-and-python">
<h1>Interfacing Fortran and Python<a class="headerlink" href="#interfacing-fortran-and-python" title="Permalink to this heading"></a></h1>
<section id="documentation">
<h2>Documentation:<a class="headerlink" href="#documentation" title="Permalink to this heading"></a></h2>
<p>A nice reference for Python for Fortran programmers:</p>
<p><a class="reference external" href="http://fortran90.org/src/rosetta.html">http://fortran90.org/src/rosetta.html</a></p>
<p>Fortran best practices (including interfacing with Python)</p>
<p><a class="reference external" href="http://fortran90.org/src/best-practices.html">http://fortran90.org/src/best-practices.html</a></p>
<p><a class="reference external" href="http://fortran90.org/src/best-practices.html#interfacing-with-python">http://fortran90.org/src/best-practices.html#interfacing-with-python</a></p>
</section>
<section id="interfacing-methods">
<h2>Interfacing methods:<a class="headerlink" href="#interfacing-methods" title="Permalink to this heading"></a></h2>
<p>There a a handful of ways to interface Fortran and Python:</p>
<section id="f2py">
<h3>f2py:<a class="headerlink" href="#f2py" title="Permalink to this heading"></a></h3>
<p><a class="reference external" href="http://docs.scipy.org/doc/numpy/user/c-info.python-as-glue.html#f2py">http://docs.scipy.org/doc/numpy/user/c-info.python-as-glue.html#f2py</a></p>
<p>Been around a long time, and maintained (at least a little) as part of the numpy project – but more useful with older fortran – not up to modern fortran standards. Perhaps the best option for interfacing with old-style fortran.</p>
</section>
<section id="fwrap">
<h3>fwrap:<a class="headerlink" href="#fwrap" title="Permalink to this heading"></a></h3>
<p><a class="reference external" href="http://fwrap.sourceforge.net/">http://fwrap.sourceforge.net/</a></p>
<p>Very promising, but its development has stalled out – so probably not a good bet unless you want to actually work on it yourself.</p>
</section>
<section id="cython-and-iso-c-binding">
<h3>Cython and iso_c_binding:<a class="headerlink" href="#cython-and-iso-c-binding" title="Permalink to this heading"></a></h3>
<p><a class="reference external" href="http://fortran90.org/src/best-practices.html#interfacing-with-python">http://fortran90.org/src/best-practices.html#interfacing-with-python</a></p>
<p>By using the iso_binding calls to extend a C interace to your fortran code, you can call it with Cython. And Cython is very useful for calling C, optimizing Python, and adding “thick” wrappers to either C or fortran.</p>
</section>
</section>
<section id="an-example">
<h2>An Example:<a class="headerlink" href="#an-example" title="Permalink to this heading"></a></h2>
<p>The following is an example of using Cython to call fortran from Python.</p>
<p>The problem at hand is an automatic gain control function function, expressed in fortran as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">subroutine</span> <span class="n">AGC</span><span class="p">(</span><span class="n">nAGC</span><span class="p">,</span><span class="n">npts</span><span class="p">,</span><span class="n">amp</span><span class="p">,</span><span class="n">ampAGC</span><span class="p">)</span>
<span class="n">real</span> <span class="n">fmax</span><span class="p">,</span><span class="n">amp</span><span class="p">(</span><span class="n">npts</span><span class="p">),</span><span class="n">absamp</span><span class="p">(</span><span class="n">npts</span><span class="p">),</span><span class="n">ampAGC</span><span class="p">(</span><span class="n">npts</span><span class="p">)</span>
<span class="n">integer</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">npts</span><span class="p">,</span><span class="n">nAGC</span><span class="p">,</span><span class="n">nAGC2</span>

<span class="n">do</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">npts</span>
   <span class="n">ampAGC</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="mf">0.</span>
   <span class="n">absamp</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">amp</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<span class="n">enddo</span>

<span class="n">nAGC2</span><span class="o">=</span><span class="n">nAGC</span><span class="o">/</span><span class="mi">2</span>

<span class="n">do</span> <span class="n">i</span><span class="o">=</span><span class="n">nAGC2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">npts</span><span class="o">-</span><span class="n">nAGC2</span>
   <span class="n">fmax</span><span class="o">=</span><span class="mf">0.</span>
   <span class="n">do</span> <span class="n">j</span><span class="o">=</span><span class="n">i</span><span class="o">-</span><span class="n">nAGC2</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="n">nAGC2</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">absamp</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">.</span><span class="n">gt</span><span class="o">.</span><span class="n">fmax</span><span class="p">)</span> <span class="n">fmax</span><span class="o">=</span><span class="n">absamp</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
   <span class="n">enddo</span>
   <span class="n">ampAGC</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="n">amp</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="n">fmax</span>
<span class="n">enddo</span>

<span class="k">return</span>

<span class="n">end</span>
</pre></div>
</div>
<section id="id1">
<h3>f2py:<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h3>
<p>f2py is a command line utility that comes with numpy. You can build a default simple wrapper with the f2py command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">f2py</span> <span class="o">-</span><span class="n">m</span> <span class="n">agc_subroutine</span> <span class="n">agc_subroutine</span><span class="o">.</span><span class="n">f</span>
</pre></div>
</div>
<p>This will result in the file <cite>agc_subroutinemodule.c</cite>, which is hte c source for a python extension module. Or you can have f2py build the module itself all at once:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">f2py</span> <span class="o">-</span><span class="n">m</span> <span class="o">-</span><span class="n">c</span> <span class="n">agc_subroutine</span> <span class="n">agc_subroutine</span><span class="o">.</span><span class="n">f</span>
</pre></div>
</div>
<p>This will generate a compiled python extension named agc_subroutine that can be imported in python as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">agc_subroutine</span>
</pre></div>
</div>
<p>f2p automatically generates a docstring for the function it created:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">agc</span> <span class="o">-</span> <span class="n">Function</span> <span class="n">signature</span><span class="p">:</span>
  <span class="n">agc</span><span class="p">(</span><span class="n">nagc</span><span class="p">,</span><span class="n">amp</span><span class="p">,</span><span class="n">ampagc</span><span class="p">,[</span><span class="n">npts</span><span class="p">])</span>
<span class="n">Required</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="n">nagc</span> <span class="p">:</span> <span class="nb">input</span> <span class="nb">int</span>
  <span class="n">amp</span> <span class="p">:</span> <span class="nb">input</span> <span class="n">rank</span><span class="o">-</span><span class="mi">1</span> <span class="n">array</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">)</span> <span class="k">with</span> <span class="n">bounds</span> <span class="p">(</span><span class="n">npts</span><span class="p">)</span>
  <span class="n">ampagc</span> <span class="p">:</span> <span class="nb">input</span> <span class="n">rank</span><span class="o">-</span><span class="mi">1</span> <span class="n">array</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">)</span> <span class="k">with</span> <span class="n">bounds</span> <span class="p">(</span><span class="n">npts</span><span class="p">)</span>
<span class="n">Optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="n">npts</span> <span class="o">:=</span> <span class="nb">len</span><span class="p">(</span><span class="n">amp</span><span class="p">)</span> <span class="nb">input</span> <span class="nb">int</span>
</pre></div>
</div>
<p>So it can be called like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">agc_subroutine</span><span class="o">.</span><span class="n">agc</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">signal</span><span class="p">,</span> <span class="n">filtered</span><span class="p">)</span>
</pre></div>
</div>
<p>where <cite>signal</cite> and <cite>filtered</cite> are 1-d arrays of float32 values, both of the same length.</p>
<section id="giving-f2py-extra-information">
<h4>Giving f2py extra information:<a class="headerlink" href="#giving-f2py-extra-information" title="Permalink to this heading"></a></h4>
<p>f2py can build an interface to a fortran subroutine, but it can’t do it all that well without some extra information. For instnce, note from the docstring that the argument <cite>ampagc</cite> is listed as an input argument, when it is really intended to be used for output.</p>
<p>To get f2py to generate an interface file use the -h option:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">f2py</span> <span class="o">-</span><span class="n">h</span> <span class="n">agc_subroutine</span><span class="o">.</span><span class="n">pyf</span> <span class="o">-</span><span class="n">m</span> <span class="n">agc_subroutine</span> <span class="n">agc_subroutine</span><span class="o">.</span><span class="n">f</span>
</pre></div>
</div>
<p>This command leaves the file agc_subroutine.pyf in the current directory, which contains:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!    -*- f90 -*-
! Note: the context of this file is case sensitive.

 python module agc_subroutine ! in
    interface  ! in :agc_subroutine
       subroutine agc(nagc,npts,amp,ampagc) ! in :agc_subroutine:agc_subroutine.f
           integer :: nagc
           integer, optional,check(len(amp)&gt;=npts),depend(amp) ::  npts=len(amp)
           real dimension(npts) :: amp
           real dimension(npts),depend(npts) :: ampagc
       end subroutine agc
   end interface
end python module agc_subroutine

! This file was auto-generated with f2py (version:2).
! See http://cens.ioc.ee/projects/f2py2e/
</pre></div>
</div>
<p>You can then add to the interface file by placing intent directives and checking code. This will clean up the interface quite a bit so that the Python module method is both easier to use and more robust. This is the edited version:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!    -*- f90 -*-
! Note: the context of this file is case sensitive.

 python module agc_subroutine ! in
    interface  ! in :agc_subroutine
       subroutine agc(nagc,npts,amp,ampagc) ! in :agc_subroutine:agc_subroutine.f
           integer :: nagc
           integer, optional,intent(hide),check(len(amp)&gt;=npts),depend(amp) ::  npts=len(amp)
           real dimension(npts) :: amp
           real dimension(npts),intent(out),depend(npts) :: ampagc
       end subroutine agc
   end interface
end python module agc_subroutine

! This file was auto-generated with f2py (version:2).
! Then hand edited for a better interface.
! See http://cens.ioc.ee/projects/f2py2e/
</pre></div>
</div>
<p>The intent directive, intent(out) is used to tell f2py that ampagc is an output variable and should be created by the interface before being passed to the underlying code. The intent(hide) directive tells f2py to not allow the user to specify the variable, npts, but instead to get it from the size of amp.</p>
</section>
<section id="inserting-directives-in-the-fortran-source">
<h4>Inserting directives in the Fortran source<a class="headerlink" href="#inserting-directives-in-the-fortran-source" title="Permalink to this heading"></a></h4>
<p>Directives can alternatively be inserted in the fortran source as special comments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span>
<span class="n">c</span>  <span class="n">Subrooutine</span> <span class="n">to</span> <span class="n">compute</span> <span class="n">an</span> <span class="n">automatic</span> <span class="n">gain</span> <span class="n">control</span> <span class="nb">filter</span><span class="o">.</span>
<span class="n">c</span>
<span class="n">c</span>
      <span class="n">subroutine</span> <span class="n">AGC</span><span class="p">(</span><span class="n">nAGC</span><span class="p">,</span><span class="n">npts</span><span class="p">,</span><span class="n">amp</span><span class="p">,</span><span class="n">ampAGC</span><span class="p">)</span>

<span class="n">CF2PY</span> <span class="n">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="p">::</span> <span class="n">ampAGC</span>
<span class="n">CF2PY</span> <span class="n">INTENT</span><span class="p">(</span><span class="n">HIDE</span><span class="p">)</span> <span class="p">::</span> <span class="n">npts</span>

      <span class="n">real</span> <span class="n">fmax</span><span class="p">,</span><span class="n">amp</span><span class="p">(</span><span class="n">npts</span><span class="p">),</span><span class="n">absamp</span><span class="p">(</span><span class="n">npts</span><span class="p">),</span><span class="n">ampAGC</span><span class="p">(</span><span class="n">npts</span><span class="p">)</span>
      <span class="n">integer</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">npts</span><span class="p">,</span><span class="n">nAGC</span><span class="p">,</span><span class="n">nAGC2</span>
</pre></div>
</div>
<p>This is probably an easier and clearer option if you maintaining the fortran source yourself.</p>
<p>Either way, you get a nicer, more pythonic and safer interface:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">agc</span> <span class="o">-</span> <span class="n">Function</span> <span class="n">signature</span><span class="p">:</span>
  <span class="n">ampagc</span> <span class="o">=</span> <span class="n">agc</span><span class="p">(</span><span class="n">nagc</span><span class="p">,</span><span class="n">amp</span><span class="p">)</span>
<span class="n">Required</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="n">nagc</span> <span class="p">:</span> <span class="nb">input</span> <span class="nb">int</span>
  <span class="n">amp</span> <span class="p">:</span> <span class="nb">input</span> <span class="n">rank</span><span class="o">-</span><span class="mi">1</span> <span class="n">array</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">)</span> <span class="k">with</span> <span class="n">bounds</span> <span class="p">(</span><span class="n">npts</span><span class="p">)</span>
<span class="n">Return</span> <span class="n">objects</span><span class="p">:</span>
  <span class="n">ampagc</span> <span class="p">:</span> <span class="n">rank</span><span class="o">-</span><span class="mi">1</span> <span class="n">array</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">)</span> <span class="k">with</span> <span class="n">bounds</span> <span class="p">(</span><span class="n">npts</span><span class="p">)</span>
</pre></div>
</div>
<p>called like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">filtered</span> <span class="o">=</span> <span class="n">agc_subroutine</span><span class="o">.</span><span class="n">agc</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">signal</span><span class="p">)</span>
</pre></div>
</div>
<p>You can see that you don’t need (and can’t) specify the length of the array, and the output array is automatically created by the wrappers, and memory-managed by python.</p>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="c_python.html" class="btn btn-neutral float-left" title="Interfacing C and Python" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2014-2025, Christopher Barker.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>